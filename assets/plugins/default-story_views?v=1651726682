modal_action_var=new bootstrap.Modal(document.querySelector('#modal_action'),{keyboard:false,backdrop:'static'});function submit_feed(){do_captcha();loading.open();$.ajax({type:'post',dataType:'json',url:base_url+'services/story-views/feed',data:$('#form_feed').serialize()}).done(function(response){loading.close();if(response.status==="success"){$("#field_feed").addClass('hidden');$("#stories_list").removeClass('hidden');stories=response.data;$.each(stories,function(id,item){$("#stories_list").append('<div class="col-6 col-md-4"><img alt="story" class="img-thumbnail img-fluid mb-2" src="'+item.image+'" onclick="select_story('+"'"+id+"'"+')"></div>');});}else{message('error',response.error);}}).fail(function(){loading().close();message('error','Something went wrong! Please try again.');});}
function submit_action(){count=0;countMax=parseInt($('#form_action input[name=quantity]').val());do_captcha();loading.open();$.ajax({type:'post',dataType:'json',url:base_url+'services/story-views/check',data:$('#form_action').serialize()}).done(function(response){loading.close();if(response.status==="success"){cd_time=response.cd_time;start();action();}else{message('error',response.error);}}).fail(function(){loading().close();message('error','Something went wrong! Please try again.');});}
function action(){$.ajax({type:'post',dataType:'json',url:base_url+'services/story-views/action',data:$('#form_action').serialize()}).done(function(response){if(response.status==="success"){count=parseInt(count+response.success);$('#form_action input[name=quantity]').val(countMax-count);if(count<countMax){action();}else{cd_exec(cd_time);complete(count);}}else{message('error',response.error);complete();}}).fail(function(){setTimeout(action,3000);});}
function start(){$("[data-bs-dismiss=modal]").hide();$('#form_action input').prop('readonly',true);$('#form_action [type=submit]').html('<i class="fas fa-circle-notch fa-spin"></i>').prop('disabled',true);}
function complete(c=false){$("[data-bs-dismiss=modal]").show();$('#form_action input').prop('readonly',false);$('#form_action [type=submit]').html('Submit').prop('disabled',false);$('#form_action input[name=quantity]').val('');if(c){modal_action_var.hide();message('success','Delivered Quantity: '+c);}}
function select_story(id){var item=stories[id];$('#form_action input[name=random]').val(generate_key());$('#form_action input[name=story]').val(item.media_id);modal_action_var.show();}
cd_exec(0);